function send(e,t){return ws.send(JSON.stringify({action:e,params:t}))}function auth(){$$("auth").validate()&&send("auth",$$("auth").getValues())}function register(){send("register",$$("auth").getValues())}function nextCrimes(){offset+=1,send("show_crimes",{offset:offset})}function prevCrimes(){offset>0&&(offset-=1),send("show_crimes",{offset:offset})}function nextProfiles(){offset+=1,send("show_profiles",{offset:offset})}function prevProfiles(){offset>0&&(offset-=1),send("show_profiles",{offset:offset})}function showCrime(e,t,i){var o=i.getAttribute("data-crimeid");o||(o=i.childNodes[0].getAttribute("data-crimeid")),send("show_crime",{crimeid:o})}function showProfile(e,t,i){var o=i.getAttribute("data-uid");o||(o=i.childNodes[0].getAttribute("data-uid")),send("show_profile",{uid:o})}function itsMe(e){webix.message.keyboard=!1;var t=webix.modalbox({title:"Type any private information of its profile",buttons:["Ok","Cancel"],text:"<input type='text' />",width:"40%",callback:function(i){"0"===i&&send("its_me",{profileid:e,info:t.getElementsByTagName("input")[0].value})}})}var grid,ws,offset=0;window.onbeforeunload=function(){return"If you leave - we deauthorize you!"},webix.ready(function(){webix.ui.fullScreen(),grid=webix.ui({container:"grid",rows:[{type:"line",id:"page",height:"100%",cols:[{id:"main",type:"clean",rows:[{id:"canvas",template:"<h2>WebSockets must be enabled</h2>"}]}]}]}),webix.ui({id:"searchPopup",view:"popup",autofocus:!1,width:300,top:70,body:{view:"list",id:"searchresult",datatype:"json",template:"#row#",data:[{row:"hello"},{row:"world"}]}}),ws=new WebSocket("ws://"+window.location.host+"/websocket"),ws.onopen=function(){ws.send('{"action": "about"}')},ws.onmessage=function(e){var t=JSON.parse(e.data);"default alert alert-danger"===t.type?webix.message(t):t.type&&t.type.indexOf("default")>-1?($("#createReport").removeClass("hidden"),webix.message(t)):"searchresult"===t.id?(webix.ui(t,$$("searchPopup"),$$("searchresult")),$$("searchPopup").show($("#searchField"))):webix.ui(t,$$("main"),$$("canvas")),grid.resize()}}),$("#searchField").on("input",function(){send("search",{text:$(this).val()})}),$("#showLast").click(function(){offset=0,send("show_profiles",{offset:0})}),$("#showLastCrimes").click(function(){offset=0,send("show_crimes",{offset:0})}),$("#showMyProfile").click(function(){send("show_my_profile")}),$("#createReport").click(function(){function e(){this.getValue()?$$("judgement").show():$$("judgement").hide()}function t(){$$("crime_form").validate()&&(send("report",$$("crime_form").getValues()),$$("crime_win").close())}var t=webix.ui({view:"window",id:"crime_win",head:{type:"clean",view:"toolbar",cols:[{template:"Report crime"},{view:"icon",icon:"times",width:50,click:"$$('crime_win').close();"}]},modal:!0,move:!0,width:420,position:"center",body:{view:"form",id:"crime_form",elementsConfig:{labelWidth:120},elements:[{view:"text",placeholder:"Name",name:"name"},{view:"text",placeholder:"Article",name:"article"},{view:"text",placeholder:"City",name:"city"},{view:"text",placeholder:"Country",name:"country"},{view:"datepicker",placeholder:"Crime Date",name:"crimedate"},{view:"text",placeholder:"Description",name:"description"},{view:"text",name:"participants",placeholder:"<profileid1>, <profileid2>, <profileid3>"},{view:"toggle",type:"iconButton",name:"closed",offIcon:"user-secret",offLabel:"In process",onIcon:"gavel",onLabel:"Closed",css:"button_warning",name:"closed",on:{onChange:e}},{view:"text",placeholder:"Judgement",id:"judgement",name:"judgement",hidden:!0},{view:"toggle",type:"iconButton",name:"private",offIcon:"eye",offLabel:"Public",onIcon:"eye-slash",onLabel:"Private",css:"button_success",name:"private"},{margin:5,cols:[{view:"button",value:"Send",css:"button_success",click:t},{view:"button",value:"Cancel",click:"$$('crime_win').close();"}]}]}}).show()});